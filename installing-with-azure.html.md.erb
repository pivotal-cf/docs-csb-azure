---
title: Installing and Configuring Cloud Service Broker on Azure
owner: Cloud Service Broker
---

<strong><%= modified_date %></strong>

This topic describes how to install and configure <%= vars.product_short %> on Azure.

## <a id="install"></a> Install <%= vars.product_short %> on Azure

To install the <%= vars.product_short %> using <%= vars.ops_manager %> Installation Dashboard:

1. Download the product file from
[<%= vars.product_network %>](https://network.tanzu.vmware.com/products/cloud-service-broker-azure/).
Azure services are provided in the `Azure` release, demarcated as `VERSION-azure`, for example,
`v1.0.0-azure`.

1. Navigate to the <%= vars.ops_manager %> Installation Dashboard and click **Import a Product** to
upload the product file.

1. Under **Import a Product**, click **+** next to the version number of <%= vars.product_short %>
in the left sidebar. This adds the tile to your staging area.

1. Click the newly added **Cloud Service Broker for Azure** tile.


## <a id="config-azure"></a> Configure the <%= vars.product_short %> on Azure

The following procedures describe configuring the panes on the <%= vars.product_short %> tile.


### <a id="config-azs"></a> Configure AZs and Networks

This section describes how to choose an AZ to run the service broker for <%= vars.product_short %>.
It also describes how to select networks for <%= vars.product_short %>.

To configure AZs and networks:

1. Click **Assign AZs and Networks**.

1. Configure the fields as follows:

    | Field | Instructions |
    |-------|----------------|
    | Place singleton jobs in | Select the AZ in which the broker VM for <%= vars.product_short %> runs. The broker runs as a singleton job. |
    | Balance other jobs in | Select the AZs in which other jobs can run. |
    | Network | Select a subnet for the <%= vars.product_short %> broker. This is typically the same subnet that includes the component VMs for <%= vars.app_runtime_full %> (<%= vars.app_runtime_abbr %>). |

1. Click **Save**.


### <a id="config-creds"></a> Configure Azure Credentials

This section describes how to configure the Azure credentials that <%= vars.product_short %> requires to
manage service instances.

To configure Azure credentials:

1. Click **Azure Config**.

1. Configure the fields as follows:

    | Field | Instructions |
    |-------|--------------|
    | Subscription ID | Enter the Azure subscription ID |
    | Tenant ID | Enter the Azure tenant ID |
    | Client ID | Enter the Azure client ID |
    | Client Secret | Enter the Azure client secret |
    | Default Resource Group | Enter the default resource group for Azure resources |
    | Location | Enter the default Azure location for resources |
    | Disable Automatic Service Registration | Select to disable automatic service registration |

1. Click **Save**.


### <a id="state-db"></a>Configure a State Database

This section describes how to associate <%= vars.product_short %> with a MySQL database,
the _state database_.
The broker requires this database to store its state.

**Prerequisite:** A small MySQL database to use as the state database.

To configure <%= vars.product_short %> with a database:

1. Click **Service Broker Config**.

    <%= image_tag("images/service-broker-config-pane.png", :alt => "Fields for configuring the service broker.
  See the following steps for detailed descriptions of the configurable fields.", :width => "400") %>


1. Configure the fields as follows:

    | Field | Instructions |
    |-------|--------------|
    | **Database host** | Enter the host name of the prerequisite database. |
    | **Database username** and **Database password** | Enter the credentials for the database. |
    | **Enable encryption of the Cloud Service Broker database** | If you want the sensitive data to be encrypted, select this checkbox and the **Add** button. If you do not want to encrypt the date, leave the checkbox unselected and do not fill in the Database Encryption Passwords fields. |
    | **Label** | Enter a unique password label. You cannot change this label after you save. |
    | **Password** | Enter a secure password that is at least 20 characters long. You cannot change this password after you save. |
    | **Primary** | Select this checkbox if this is the password that you want to use to encrypt the data. You must mark one and only one password as primary.|

1. Click **Save**.

1. Return to the <%= vars.ops_manager %> Installation Dashboard.

1. Click **Review Pending Changes**.

1. Click **Apply changes** to install the <%= vars.product_short %> tile.

1. Set up encryption for the sensitive data in the database.

Covered:     * If you want the sensitive data to be encrypted in the database tick **Enable encryption of the Cloud Service Broker database** and add an encryption password in the list of **Database Encryption Passwords**.
    For the password configure these fields:
        * **Label**: Enter a unique password label. Do not change once saved.
        * **Password**: Enter a secure password that is at least 20 characters long. Do not change once saved.
        * **Primary**: Tick if this is the password that should be used to encrypt the data. You must mark one password as primary. Do not mark more than one password as primary.


<%# If needed, include additional configuration information below.
For example, maybe there are configuration options not required for installation but which could be
useful for certain users.
Typical topics include:**

+ **Self-service:** Do you have recommendations for how to configure/design plans in the tile so that
users can choose the best options for themselves?
+ **High availability:** How do you configure/deploy X Service tile to be highly available? %>

### <a id="services"></a> Configure Services with <%= vars.product_short %>

This section describes how to configure services and service plans offered by the
<%= vars.product_short %> within the Cloud Foundry Marketplace on your instance of Cloud Foundry.

<%= vars.product_short %> specifies new service plans through JSON.
An example is provided, using the smallest possible size, within each service.

To configure services and service plans:

1. Click the already-installed <%= vars.product_short %> for Azure tile in your
<%= vars.ops_manager %> tile Dashboard.

1. Find the service you want to make available in the left hand navigation under
the **Settings** tab.

1. Enter additional plans as additional JSON objects within the provided field.
For details about properties for each service configuration, see
<a href="reference.html">Service Plan Reference</a>.

1. Click **Save**.

1. Return to the <%= vars.ops_manager %> Installation Dashboard and click **Review Pending Changes**.

1. Click **Apply changes**.

1. Review your Cloud Foundry Marketplace to see the new plan sizes.


## <a id="rotate-password"></a>Rotate Password on the State Database

If you have already set an encryption password and want to change it, follow the instructions below:

To rotate the password on the state database:

1. Click **Service Broker Config**.

2. Clear the **Primary** checkbox.

3. Click **Add**.

4. Enter a new **Label** and **Password** for the new password, and select  **Primary**.

    You cannot change the label or password after you save.

1. Click **Save**.

1. Return to the <%= vars.ops_manager %> Installation Dashboard.

1. Click **Review Pending Changes**.

1. Click **Apply changes** to install the <%= vars.product_short %> tile.

1. (Recommended) After the apply changes process completes, delete the non-primary label and password pair and apply changes again. 

## <a id="remove-encryption"></a> Remove Encryption from the State Database

If the data in the state database was previously encrypted and you want to disable encryption, follow the instructions below.

To remove encryption from the state database:

1. Click **Service Broker Config**.

2. Clear the **Enable encryption of the Cloud Service Broker database** checkbox.

4. Clear the **Primary** checkbox, but do not change the Label or Password fields.

1. Click **Save**.

1. Return to the <%= vars.ops_manager %> Installation Dashboard.

1. Click **Review Pending Changes**.

1. Click **Apply changes** to install the <%= vars.product_short %> tile.

1. (Recommended) After the apply changes process completes, delete all label and password pairs and apply changes again. 
